%Question 6
mito_gbk = getgenbank('NC_001643'); %chimp
chimp = mito_gbk.Sequence;
mitochondria_length = length(chimp)
first_300_bases = seqdisp(chimp(1:300))

figure
ntdensity(chimp)

bases = basecount(chimp)

compBases = basecount(seqrcomplement(chimp))

figure
basecount(chimp,'chart','pie');
title('Distribution of Nucleotide Bases for Chimpanzee Mitochondrial Genome');

%question 7 and 8
chimp = getgenbank('NC_001643','SequenceOnly',true);
whos chimp
codoncount(chimp)

%get ORFs
orf = seqshoworfs(chimp,'MINIMUMLENGTH',3, 'geneticcode',2,'frames','all','nodisplay','true');
%get ORFs in a similar random permutaion
orf1 = seqshoworfs(chimp(randperm(length(chimp))),'MINIMUMLENGTH',3,'geneticcode',2,'frames','all','nodisplay','true');

%collect all ORFs
ORFLength=[];
for i=1:6
   for j=1:length(orf(i).Stop)
    ORFLength=[ORFLength; orf(i).Stop(j)+2 - orf(i).Start(j)];
   end
end
disp("Number of ORFs in chimpanzee mitochondrion")
length(ORFLength)

%thresholding using random permutaion sequence's max length ORF
ORFLength1=[];
for i=1:6
   for j=1:length(orf1(i).Stop)
    ORFLength1=[ORFLength1; orf1(i).Stop(j)+2 - orf1(i).Start(j)];
   end
end
length(ORFLength1)

max_threshold=max(ORFLength1)
disp("Number of significant ORFs in chimpanzee mitochondrion")
n_max=length(find(ORFLength>=max_threshold))

%get significant ORFs
orf_threshold = seqshoworfs(chimp,'MINIMUMLENGTH',max_threshold/3, 'geneticcode',2,'frames','all','nodisplay','true');
orfNew=[];
for i=1:6
    for j=1:length(orf_threshold(i).Stop)
        orfNew=[orfNew; orf_threshold(i).Stop(j)+2 - orf_threshold(i).Start(j)];
    end
end

%question9
protein = chimp(orf_threshold(1).Start(1):orf_threshold(1).Stop(1)+2) %first ORF selected
aminoacid = nt2aa(protein, 'geneticcode',2)
aminoacid(1:50)
seq1 = getgenpept('Q9T9W3','SequenceOnly',true);
seq2 = getgenpept('AIV00479','SequenceOnly',true);
seq3 = getgenpept('AEQ36262','SequenceOnly',true);
seq4 = getgenpept('ANQ92411','SequenceOnly',true);
seq5 = getgenpept('AMB65312','SequenceOnly',true);
seq6 = getgenpept('AJO25286','SequenceOnly',true);
seqs = {seq1, seq2, seq3, seq4, seq5, seq6};
multialign(seqs)


humanProtein = getgenpept('AFF91323','SequenceOnly',true);
chimpProtein = aminoacid;

%question10
human = getgenbank('NC_012920','SequenceOnly',true);
h_orf = seqshoworfs(human,'MINIMUMLENGTH',1, 'geneticcode',2,'frames','all','nodisplay','true');
h_orf1= seqshoworfs(human(randperm(length(human))),'MINIMUMLENGTH',1,'geneticcode',2,'frames','all','nodisplay','true');
h_ORFLength=[];
for i=1:6
   for j=1:length(h_orf(i).Stop)
    h_ORFLength=[h_ORFLength; h_orf(i).Stop(j)+2 - h_orf(i).Start(j)];
   end
end
disp("Number of ORFs in human mitochondrion")
length(h_ORFLength)
h_ORFLength1=[];
for i=1:6
   for j=1:length(h_orf1(i).Stop)
    h_ORFLength1=[h_ORFLength1; h_orf1(i).Stop(j)+2 - h_orf1(i).Start(j)];
   end
end
length(h_ORFLength1)
h_max_threshold=max(h_ORFLength1)
disp("Number of significant ORFs in human mitochondrion")
h_n_max=length(find(h_ORFLength>=h_max_threshold))
h_orf_threshold = seqshoworfs(human,'MINIMUMLENGTH',h_max_threshold/3, 'geneticcode',2,'frames','all','nodisplay','true');

h_orfNew=[];
for i=1:6
    for j=1:length(h_orf_threshold(i).Stop)
        h_orfNew=[h_orfNew; h_orf_threshold(i).Stop(j)+2 - h_orf_threshold(i).Start(j)];
    end
end

%question 10 and 11
%convert to amino acid and store start stop values
codons=[];
aminoacid=[];
for i=1:6
    for j= 1:length(orf_threshold(i).Stop)
        proteinSeq = chimp(orf_threshold(i).Start(j):orf_threshold(i).Stop(j)+2);
        codons= [codons; string(proteinSeq)];
        aminoacid = [aminoacid; string(nt2aa(proteinSeq, 'geneticcode',2)),orf_threshold(i).Start(j),orf_threshold(i).Stop(j)+2];
    end
end

% length(codons)
% length(aminoacid)
h_protein=[];
h_aminoacid=[];
for i=1:6
    for j= 1:length(h_orf_threshold(i).Stop)
        protein = human(h_orf_threshold(i).Start(j):h_orf_threshold(i).Stop(j)+2);
        h_protein= [h_protein; string(protein)];
        h_aminoacid = [h_aminoacid; string(nt2aa(protein, 'geneticcode',2)),h_orf_threshold(i).Start(j),h_orf_threshold(i).Stop(j)+2];
    end
end
% length(h_protein)
% length(h_aminoacid)
%question 10

scores = [];
for i=1: length(h_aminoacid)
    scores = [scores; i,nwalign(char(h_aminoacid(i,1)), char(aminoacid(1,1)), 'scoringmatrix','blosum30','gapopen',5,'extendgap',5)];
end
scores

tobetested = find(scores(:,2) > 50)

for i=1:length(tobetested)
    h = scores(tobetested(i),1);
    c = 1;
    score = scores(tobetested(i),2);
    human_protein = char(h_aminoacid(h,1));
    chimp_protein = char(aminoacid(c,1));
    n = 1000;
    globalscores = zeros(n,1);
    chimpLen = length(chimp_protein);
    for j = 1:n
        perm = randperm(chimpLen);
        globalscores(j) = nwalign(human_protein,chimp_protein(perm),'scoringmatrix','blosum30','gapopen',5,'extendgap',5);
    end
    figure
    buckets = ceil(n/5);
    hist(globalscores,buckets)
    hold on;
    stem(score,1,'k')
    xlabel('Score'); ylabel('Number of Sequences');
    titleStr = strcat('Significance plot for ORF(' ,h_aminoacid(h,2),':',h_aminoacid(h,3), ...
        ') human and ORF(',aminoacid(1,2),':',aminoacid(1,3), ') chimpanzee');
    title(titleStr);
    hold off;
    p_value = length(find(globalscores >= score)) / 1000
    score
    titleStr
end

%question 11
% all_amino = [h_aminoacid;aminoacid];
% % length(all_amino)
% %exploring with multialign
% ma = multialign(char(all_amino(:,1)))
% seqalignviewer(ma)
% 
% %get alignment scores for all combinations and threshold at 100
% scores = [];
% for i=1: length(h_aminoacid)
%     for j=1:length(aminoacid)
%         scores = [scores; i,j,nwalign(char(h_aminoacid(i,1)), char(aminoacid(j,1)), 'scoringmatrix','blosum30','gapopen',5,'extendgap',5)];
%     end
% end
% 
% tobetested = find(scores(:,3) > 100);
% disp('alignments to be tested')
% length(tobetested)
% 
% for i=1: length(tobetested)
%     h = scores(tobetested(i),1);
%     c = scores(tobetested(i),2);
%     human_protein = char(h_aminoacid(h,1));
%     chimp_protein = char(aminoacid(c,1));
%     [score1, alignment] = nwalign(human_protein, chimp_protein, ...
%             'scoringmatrix','blosum30','gapopen',5,'extendgap',5);
%      showalignment(alignment)
%      %alignment
% end
% %test with significance plot
% for i=1:length(tobetested)
%     h = scores(tobetested(i),1);
%     c = scores(tobetested(i),2);
%     score = scores(tobetested(i),3);
%     human_protein = char(h_aminoacid(h,1));
%     chimp_protein = char(aminoacid(c,1));
%     n = 1000; %1000 random permutations of chimpanzee sequences
%     globalscores = zeros(n,1);
%     chimpLen = length(chimp_protein);
%     for j = 1:n
%         perm = randperm(chimpLen);
%         globalscores(j) = nwalign(human_protein,chimp_protein(perm),'scoringmatrix','blosum30','gapopen',5,'extendgap',5);
%     end
%     figure
%     buckets = ceil(n/5);
%     hist(globalscores,buckets)
%     hold on;
%     stem(score,1,'k')
%     xlabel('Score'); ylabel('Number of Sequences');
%     titleStr = strcat('Significance plot for ORF(' ,h_aminoacid(h,2),':',h_aminoacid(h,3), ...
%         ') human and ORF(',aminoacid(c,2),':',aminoacid(c,3), ') chimpanzee');
%     title(titleStr);
%     hold off;
%     p_value = length(find(globalscores >= score)) / 1000
% end

